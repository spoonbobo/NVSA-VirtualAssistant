<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frontend &mdash; NVIDIA SA Virtual Assistant 1 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Unseen Intent Handling" href="intent_handling.html" />
    <link rel="prev" title="Deploy" href="deploy.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> NVIDIA SA Virtual Assistant
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="arch.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="prereq.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deploy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frontend</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#peeking-flask-app">Peeking Flask App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#app-py">app.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#grpc-protocol">gRPC protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="#web-template">Web template</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="intent_handling.html">Unseen Intent Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">Sample Applications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NVIDIA SA Virtual Assistant</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Frontend</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/frontend.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="frontend">
<span id="id1"></span><h1>Frontend<a class="headerlink" href="#frontend" title="Permalink to this headline">¶</a></h1>
<p>There are number of frontends to access Riva AI Services. This sections demonstrates how we can create a chatbot interface using <a class="reference external" href="https://flask.palletsprojects.com/en/2.0.x/quickstart/">Flask</a> web framework.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Install flask using pip in your environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install Flask
</pre></div>
</div>
</div>
<div class="section" id="peeking-flask-app">
<h2>Peeking Flask App<a class="headerlink" href="#peeking-flask-app" title="Permalink to this headline">¶</a></h2>
<p>In this section, we are going to create a Flask app to deploy DGX Chatbot in following structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.
├── app.py
├── cert
│   ├── server.crt
│   ├── server.key
│   └── ssl.conf
├── dgxAudios
│   └── audio_file.wav
├── dgx_enquire_audio.py
├── dgx_enquire.py
├── dgx_resp.py
├── dgxUtter
│   └── dgx_utter.txt
├── README.md
├── static
│   ├── banner.jpg
│   ├── bg1.jpg
│   ├── chat_theme.css
│   ├── dgxChat_arch.jpg
│   ├── icon.png
│   ├── main.css
│   └── script.js
├── stream.js
└── templates
    ├── DGXChat.html
    └── home.html
</pre></div>
</div>
</div>
<div class="section" id="app-py">
<h2>app.py<a class="headerlink" href="#app-py" title="Permalink to this headline">¶</a></h2>
<p><code class="file docutils literal notranslate"><span class="pre">app.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="kn">import</span> <span class="n">secure_filename</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">soundfile</span> <span class="kn">as</span> <span class="nn">sf</span>
<span class="kn">import</span> <span class="nn">librosa</span>
<span class="kn">import</span> <span class="nn">wave</span>
<span class="kn">from</span> <span class="nn">pydub</span> <span class="kn">import</span> <span class="n">AudioSegment</span>
<span class="kn">from</span> <span class="nn">dgx_enquire</span> <span class="kn">import</span> <span class="n">dgx_enquire</span>
<span class="kn">from</span> <span class="nn">dgx_enquire_audio</span> <span class="kn">import</span> <span class="n">dgx_enquire_audio</span>
<span class="kn">from</span> <span class="nn">dgx_resp</span> <span class="kn">import</span> <span class="n">dgx_resp</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">AUDIO_SAMPLE_RATE</span> <span class="o">=</span> <span class="mi">16000</span>

<span class="n">dgxWelcomeMsg</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hi, I&#39;m DGX Bot. You can ask me questions about DGX systems. For example: &quot;</span><span class="p">,</span>
<span class="s2">&quot; &quot;</span><span class="p">,</span>
<span class="s2">&quot;What is DGX System?&quot;</span><span class="p">,</span>
<span class="s2">&quot;How to monitor the DGX System?&quot;</span><span class="p">,</span>
<span class="s2">&quot;What are the storage options available for DGX system?&quot;</span><span class="p">,</span>
<span class="s2">&quot;What are the benefits of using DGX?&quot;</span><span class="p">]</span>

<span class="n">dgxData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;queries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">],</span>
    <span class="s2">&quot;responses&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">dgxWelcomeMsg</span><span class="p">],</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;reloadSpeech&quot;</span><span class="p">:</span> <span class="bp">False</span>  <span class="c1"># offset the reload.</span>
<span class="p">}</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">root_page</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/dgxSubmit&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dgxSubmit</span><span class="p">():</span>
    <span class="n">dgx_query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;dgx_query&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dgx_query</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dgx_query</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">dgx_query</span> <span class="o">=</span> <span class="s2">&quot;Hello, DGX!&quot;</span>
    <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgx_query</span><span class="p">)</span>
    <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;dgxChat&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">dgx_query</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/dgxUpload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dgxUpload</span><span class="p">():</span>
    <span class="k">if</span> <span class="s2">&quot;audio_file&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="n">dgxAudioFile</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;audio_file&#39;</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;dgxAudios&quot;</span><span class="p">))</span>
        <span class="n">audioSavePath</span> <span class="o">=</span> <span class="s2">&quot;dgxAudios/audio_file_{}.wav&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">dgxAudioFile</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">audioSavePath</span><span class="p">)</span>
        <span class="n">audio</span><span class="p">,</span> <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">audioSavePath</span><span class="p">)</span>
        <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">audioSavePath</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">)</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">audioSavePath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">audioSavePath</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c1"># Accepted by Riva</span>
        <span class="n">dgx_query</span> <span class="o">=</span> <span class="n">dgx_enquire_audio</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgx_query</span><span class="p">)</span>
        <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;dgxChat&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">dgx_query</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/DGXChat&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dgxChat</span><span class="p">():</span>
    <span class="n">dgxQuery</span> <span class="o">=</span> <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">][</span><span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dgxQuery</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;dgxUtter/dgx_utter.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dgxQuery</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dgxQuery</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
        <span class="n">className</span> <span class="o">=</span> <span class="n">dgx_enquire</span><span class="p">([</span><span class="n">dgxQuery</span><span class="p">])</span>
        <span class="n">dgxResp</span> <span class="o">=</span> <span class="n">dgx_resp</span><span class="p">(</span><span class="n">className</span><span class="p">)</span>
        <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgxResp</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dgxData</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;DGXChat.html&quot;</span><span class="p">,</span> <span class="n">dgxData</span><span class="o">=</span><span class="n">dgxData</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<ul>
<li><p class="first"><code class="code docutils literal notranslate"><span class="pre">dgxData</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">&quot;queries&quot;:</span> <span class="pre">[None],</span> <span class="pre">&quot;responses&quot;:</span> <span class="pre">[dgxWelcomeMsg],</span> <span class="pre">&quot;count&quot;:</span> <span class="pre">1</span> <span class="pre">}</span></code></p>
<blockquote>
<div><p>The queries and responses in each chatting session are stored in dgxData object, where count gains increment upon each query sent.</p>
</div></blockquote>
</li>
<li><div class="first highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/dgxSubmit&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dgxSubmit</span><span class="p">():</span>
    <span class="n">dgx_query</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;dgx_query&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dgx_query</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dgx_query</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">dgx_query</span> <span class="o">=</span> <span class="s2">&quot;Hello, DGX!&quot;</span>
    <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgx_query</span><span class="p">)</span>
    <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;dgxChat&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="n">dgx_query</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
<p>The text input from the chatting page is posted to the Flask backend through <code class="code docutils literal notranslate"><span class="pre">/dgxSubmit</span></code>, and the input is redirected to the chatting backend <code class="code docutils literal notranslate"><span class="pre">/dgxChat</span></code>. If user input voice message, the audio is posted to the backend through <code class="code docutils literal notranslate"><span class="pre">/dgxUpload</span></code>, where the audio is converted to text using DGX ASR service and then redirected to <code class="code docutils literal notranslate"><span class="pre">/dgxChat</span></code>.</p>
<ul>
<li><div class="first highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/DGXChat&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dgxChat</span><span class="p">():</span>
    <span class="n">dgxQuery</span> <span class="o">=</span> <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">][</span><span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dgxQuery</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;dgxUtter/dgx_utter.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dgxQuery</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dgxQuery</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]):</span>
        <span class="n">className</span> <span class="o">=</span> <span class="n">dgx_enquire</span><span class="p">([</span><span class="n">dgxQuery</span><span class="p">])</span>
        <span class="n">dgxResp</span> <span class="o">=</span> <span class="n">dgx_resp</span><span class="p">(</span><span class="n">className</span><span class="p">)</span>
        <span class="n">dgxData</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dgxResp</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">dgxData</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;DGXChat.html&quot;</span><span class="p">,</span> <span class="n">dgxData</span><span class="o">=</span><span class="n">dgxData</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Each query from user is saved to file:<cite>dgx_utter.txt</cite> (for re-training the model). NVIDIA DGX Chatbot determines proper response based on className. Lastly, <code class="code docutils literal notranslate"><span class="pre">dgxData</span></code> is rendered to <code class="file docutils literal notranslate"><span class="pre">DGXChat.html</span></code>  using jinja2 engine, and each of queries and responses is iterated in the chatting session.</p>
</div>
<div class="section" id="grpc-protocol">
<h2>gRPC protocol<a class="headerlink" href="#grpc-protocol" title="Permalink to this headline">¶</a></h2>
<p><code class="file docutils literal notranslate"><span class="pre">dgx_enquire.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dgx_enquire_audio</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="s2">&quot;10.19.27.126:50051&quot;</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">rasr_srv</span><span class="o">.</span><span class="n">RivaSpeechRecognitionStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">rasr</span><span class="o">.</span><span class="n">RecognitionConfig</span><span class="p">(</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">ra</span><span class="o">.</span><span class="n">AudioEncoding</span><span class="o">.</span><span class="n">LINEAR_PCM</span><span class="p">,</span>
        <span class="n">sample_rate_hertz</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">getframerate</span><span class="p">(),</span>
        <span class="n">language_code</span><span class="o">=</span><span class="s2">&quot;en-US&quot;</span><span class="p">,</span>
        <span class="n">max_alternatives</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">enable_automatic_punctuation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">audio_channel_count</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">rasr</span><span class="o">.</span><span class="n">RecognizeRequest</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">audio</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Recognize</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">alternatives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transcript</span>
</pre></div>
</div>
<p>gRPC protocol is used to facilitate the communications between the DGX Chatbot and Riva Server. After users record voice messages, the recorded audio is firstly posted from the front-end interface (website) to Flask backend through fetch API, then submitted to Riva Server as <code class="code docutils literal notranslate"><span class="pre">riva_api.riva_asr_pb2.RecognizeRequest</span></code>, followed by the Riva Server receiving the request, recognizing the audio, and returning the transcript.</p>
<p><code class="file docutils literal notranslate"><span class="pre">dgx_enquire_audio.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dgx_enquire</span><span class="p">(</span><span class="n">queries</span><span class="p">):</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="s2">&quot;10.19.27.126:50051&quot;</span><span class="p">)</span>
    <span class="n">riva_nlp</span> <span class="o">=</span> <span class="n">rnlp_srv</span><span class="o">.</span><span class="n">RivaLanguageUnderstandingStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">rnlp</span><span class="o">.</span><span class="n">TextClassRequest</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;riva_text_classification_default&quot;</span>

    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="n">resp</span> <span class="o">=</span> <span class="n">riva_nlp</span><span class="o">.</span><span class="n">ClassifyText</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">class_name</span>
</pre></div>
</div>
<p>The typed queries or transcripts are submitted to Riva Server as <code class="code docutils literal notranslate"><span class="pre">riva_api.riva_asr_pb2.TextClassRequest</span></code>, followed by the Riva Server receiving the request, classifying the queries, and returning the intent classified. Then, the chatbot utters the response to users based on the intent.</p>
</div>
<div class="section" id="web-template">
<h2>Web template<a class="headerlink" href="#web-template" title="Permalink to this headline">¶</a></h2>
<p><code class="file docutils literal notranslate"><span class="pre">templates/DGXChat.html</span></code>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span>
            <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&quot;</span>
            <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
            <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3&quot;</span>
            <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span>
        <span class="p">/&gt;</span>

        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;static&#39;, filename=&#39;main.css&#39;) }}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="p">/&gt;</span>

        <span class="c">&lt;!-- Scrolling behaviour (Legacy) --&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
            <span class="kd">function</span> <span class="nx">updateScroll</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;overlay-scroll&#39;</span><span class="p">)</span>
                <span class="nx">element</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">scrollHeight</span>
            <span class="p">}</span>
            <span class="nx">setInterval</span><span class="p">(</span><span class="nx">updateScroll</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>DGX Chatbot<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid w-75 mh-75 py-4&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background: rgba(0, 0, 0, 0) !important&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">header</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pb-3 mb-4 border-bottom&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background: rgba(0, 0, 0, 0) !important&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;d-flex align-items-center text-dark text-decoration-none&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;static&#39;, filename=&#39;icon.png&#39;) }}&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 2rem&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fs-4 text-white&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;margin-left: 0.5rem&quot;</span><span class="p">&gt;</span>NVIDIA AI Hub<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;p-5 bg-light mh-75 rounded-3&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background: rgba(0, 0, 0, 0.5) !important&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span>
                    <span class="na">class</span><span class="o">=</span><span class="s">&quot;overflow-auto&quot;</span>
                    <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 35rem; scroll-behavior: smooth; display: flex; flex-direction: column-reverse&quot;</span>
                <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid rounded mt-2&quot;</span><span class="p">&gt;</span>
                        {% for i in range(dgxData[&quot;count&quot;]) %}
                        <span class="c">&lt;!-- User queries --&gt;</span>
                        {% if dgxData[&quot;queries&quot;][i] != None %}
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row mb-3&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card float-end rouded&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: inline-block; max-width: 75%&quot;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-text mb-0&quot;</span><span class="p">&gt;</span>{{ dgxData[&quot;queries&quot;][i] }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% endif %}

                        <span class="c">&lt;!-- Chatbot responses --&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row mb-3&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-white py-1&quot;</span><span class="p">&gt;</span>
                                DGX Chatbot
                                <span class="p">&lt;</span><span class="nt">svg</span>
                                    <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span>
                                    <span class="na">width</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                                    <span class="na">height</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                                    <span class="na">fill</span><span class="o">=</span><span class="s">&quot;currentColor&quot;</span>
                                    <span class="na">class</span><span class="o">=</span><span class="s">&quot;bi bi-robot&quot;</span>
                                    <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 16 16&quot;</span>
                                <span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">path</span>
                                        <span class="na">d</span><span class="o">=</span><span class="s">&quot;M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5ZM3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.58 26.58 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.933.933 0 0 1-.765.935c-.845.147-2.34.346-4.235.346-1.895 0-3.39-.2-4.235-.346A.933.933 0 0 1 3 9.219V8.062Zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a24.767 24.767 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25.286 25.286 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135Z&quot;</span>
                                    <span class="p">/&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">path</span>
                                        <span class="na">d</span><span class="o">=</span><span class="s">&quot;M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2V1.866ZM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5Z&quot;</span>
                                    <span class="p">/&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card float-left rounded-2&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: inline-block; max-width: 75%&quot;</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-color: rgba(50, 205, 20, 0.3) !important&quot;</span><span class="p">&gt;</span>
                                        {% if dgxData[&quot;responses&quot;][i] != None %} {% for resp in dgxData[&quot;responses&quot;][i]
                                        %} {% if resp != None %} {% if resp != &quot; &quot; %}
                                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-text mb-0&quot;</span><span class="p">&gt;</span>{{ resp }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                        {% else %} <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
                                        {% endif %} {% endif %} {% endfor %} {% else %}
                                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-text mb-0&quot;</span><span class="p">&gt;</span>
                                            Sorry, I don&#39;t quite get what you asked. Can you rephrase?
                                        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                                        {% endif %}
                                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row mt-3&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-11&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/dgxSubmit&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;input-group input-group-lg&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">input</span>
                                    <span class="na">id</span><span class="o">=</span><span class="s">&quot;dgxQueryInput&quot;</span>
                                    <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span>
                                    <span class="na">name</span><span class="o">=</span><span class="s">&quot;dgx_query&quot;</span>
                                    <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Hello, DGX!&quot;</span>
                                    <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span>
                                    <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Sizing example input&quot;</span>
                                    <span class="na">aria-describedby</span><span class="o">=</span><span class="s">&quot;inputGroup-sizing-lg&quot;</span>
                                <span class="p">/&gt;</span>

                                <span class="c">&lt;!-- Send message --&gt;</span>
                                <span class="p">&lt;</span><span class="nt">button</span>
                                    <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-secondary&quot;</span>
                                    <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                                    <span class="na">value</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                                    <span class="na">id</span><span class="o">=</span><span class="s">&quot;button-addon2&quot;</span>
                                <span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">svg</span>
                                        <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span>
                                        <span class="na">width</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                                        <span class="na">height</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                                        <span class="na">fill</span><span class="o">=</span><span class="s">&quot;currentColor&quot;</span>
                                        <span class="na">class</span><span class="o">=</span><span class="s">&quot;bi bi-send-fill&quot;</span>
                                        <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 16 16&quot;</span>
                                    <span class="p">&gt;</span>
                                        <span class="p">&lt;</span><span class="nt">path</span>
                                            <span class="na">fill-rule</span><span class="o">=</span><span class="s">&quot;evenodd&quot;</span>
                                            <span class="na">d</span><span class="o">=</span><span class="s">&quot;M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89.471-1.178-1.178.471L5.93 9.363l.338.215a.5.5 0 0 1 .154.154l.215.338 7.494-7.494Z&quot;</span>
                                        <span class="p">/&gt;</span>
                                    <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-1&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;input-group input-group-lg&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;dgxAudioControl&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-outline-secondary&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">svg</span>
                                    <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span>
                                    <span class="na">width</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                                    <span class="na">height</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                                    <span class="na">fill</span><span class="o">=</span><span class="s">&quot;currentColor&quot;</span>
                                    <span class="na">class</span><span class="o">=</span><span class="s">&quot;bi bi-mic&quot;</span>
                                    <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 16 16&quot;</span>
                                <span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">path</span>
                                        <span class="na">d</span><span class="o">=</span><span class="s">&quot;M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z&quot;</span>
                                    <span class="p">/&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">path</span>
                                        <span class="na">d</span><span class="o">=</span><span class="s">&quot;M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z&quot;</span>
                                    <span class="p">/&gt;</span>
                                <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;micStatus&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-white py-3&quot;</span><span class="p">&gt;</span>
                        Speech recognition is in offline mode. Press
                        <span class="p">&lt;</span><span class="nt">svg</span>
                            <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span>
                            <span class="na">width</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                            <span class="na">height</span><span class="o">=</span><span class="s">&quot;16&quot;</span>
                            <span class="na">fill</span><span class="o">=</span><span class="s">&quot;currentColor&quot;</span>
                            <span class="na">class</span><span class="o">=</span><span class="s">&quot;bi bi-mic&quot;</span>
                            <span class="na">viewBox</span><span class="o">=</span><span class="s">&quot;0 0 16 16&quot;</span>
                        <span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">path</span>
                                <span class="na">d</span><span class="o">=</span><span class="s">&quot;M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z&quot;</span>
                            <span class="p">/&gt;</span>
                            <span class="p">&lt;</span><span class="nt">path</span>
                                <span class="na">d</span><span class="o">=</span><span class="s">&quot;M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z&quot;</span>
                            <span class="p">/&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">svg</span><span class="p">&gt;</span>
                        to start recording, and press it again to stop recording.
                    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;micMsg&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted mt-0&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
                        <span class="kr">const</span> <span class="nx">uploadURL</span> <span class="o">=</span> <span class="s2">&quot;{{ url_for(&#39;dgxUpload&#39;) }}&quot;</span>
                        <span class="kr">const</span> <span class="nx">downloadLink</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;download&#39;</span><span class="p">)</span>
                        <span class="kr">const</span> <span class="nx">stopButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;dgxAudioControl&#39;</span><span class="p">)</span>
                        <span class="kd">var</span> <span class="nx">microphoneStatus</span> <span class="o">=</span> <span class="s1">&#39;Not Recording&#39;</span> <span class="c1">// init state</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;micMsg&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span>
                            <span class="s1">&#39;Streaming recognition implementation is in progress. Current offline recognition may be slow, use it at your own risk&#39;</span>

                        <span class="kr">const</span> <span class="nx">handleSuccess</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
                            <span class="c1">// microphoneStatus = !microphoneStatus</span>
                            <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s1">&#39;audio/webm&#39;</span> <span class="p">}</span>
                            <span class="kd">let</span> <span class="nx">recordedChunks</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="kd">let</span> <span class="nx">mediaRecorder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MediaRecorder</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

                            <span class="nx">mediaRecorder</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;dataavailable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">recordedChunks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
                            <span class="p">})</span>

                            <span class="nx">mediaRecorder</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                                <span class="kd">let</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span><span class="nx">recordedChunks</span><span class="p">,</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;audio/webm&#39;</span> <span class="p">})</span>
                                <span class="kd">let</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
                                <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;audio_file&#39;</span><span class="p">,</span> <span class="nx">blob</span><span class="p">,</span> <span class="s1">&#39;audio_file.wav&#39;</span><span class="p">)</span>
                                <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/dgxUpload&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span><span class="p">,</span> <span class="nx">cache</span><span class="o">:</span> <span class="s1">&#39;no-cache&#39;</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(</span>
                                    <span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                                        <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
                                            <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                                        <span class="p">}</span>
                                    <span class="p">}</span>
                                <span class="p">)</span>
                            <span class="p">})</span>
                            <span class="nx">stopButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">microphoneStatus</span> <span class="o">==</span> <span class="s1">&#39;Recording&#39;</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">mediaRecorder</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
                                    <span class="nx">microphoneStatus</span> <span class="o">=</span> <span class="s1">&#39;Not Recording&#39;</span>
                                    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;micStatus&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span>
                                        <span class="s1">&#39;Microphone Status: &#39;</span> <span class="o">+</span> <span class="nx">microphoneStatus</span>
                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="nx">mediaRecorder</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>
                                    <span class="nx">microphoneStatus</span> <span class="o">=</span> <span class="s1">&#39;Recording&#39;</span>
                                    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;micStatus&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span>
                                        <span class="s1">&#39;Microphone Status: &#39;</span> <span class="o">+</span> <span class="nx">microphoneStatus</span>
                                <span class="p">}</span>
                            <span class="p">})</span>
                        <span class="p">}</span>
                        <span class="nx">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span> <span class="nx">audio</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">video</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">handleSuccess</span><span class="p">)</span>
                    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pt-3 mt-4 text-muted border-top&quot;</span><span class="p">&gt;</span><span class="ni">&amp;copy;</span> 2021<span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span>
            <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js&quot;</span>
            <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p&quot;</span>
            <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span>
        <span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="deploy.html" class="btn btn-neutral float-left" title="Deploy" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="intent_handling.html" class="btn btn-neutral float-right" title="Unseen Intent Handling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, NVAITC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

<style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search,
    .wy-nav-top {
        background: #76b900;
    }


    /* Sidebar */
    /* .wy-nav-side {
        background: #76b900;
    } */
</style>


</body>
</html>